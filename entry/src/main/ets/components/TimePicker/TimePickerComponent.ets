/**
 * æ—¶é—´é€‰æ‹©å™¨å°è£…ç»„ä»¶
 */

import { TimePickerController } from './TimePickerController';
import { TimePickerDialog } from './TimePickerDialog';

@Component
export struct TimePickerComponent {
  // ğŸ”¥ ä½¿ç”¨ @Link ç»‘å®šæ§åˆ¶å™¨
  @Link controller: TimePickerController;

  // å¯¹è¯æ¡†æ§åˆ¶å™¨
  private dialogController: CustomDialogController | null = null;

  // å›è°ƒå‡½æ•°
  private onCancel?: () => void;
  private onConfirm?: (timestamp: number) => void;

  aboutToAppear(): void {
    // åˆå§‹åŒ–å¯¹è¯æ¡†
    this.initDialogController();

    // å°†æ§åˆ¶å™¨çš„æ–¹æ³•ç»‘å®šåˆ°æœ¬ç»„ä»¶
    this.controller.setOpenDialogFunc(this.openDialog.bind(this));
    this.controller.setSetCallbacksFunc(this.setCallbacks.bind(this));
  }

  aboutToDisappear(): void {
    this.dialogController = null;
  }

  /**
   * åˆå§‹åŒ–å¯¹è¯æ¡†æ§åˆ¶å™¨
   */
  private initDialogController(): void {
    this.dialogController = new CustomDialogController({
      builder: TimePickerDialog({
        cancel: () => {
          this.onCancel?.();
        },
        confirm: (timestamp: number) => {
          this.onConfirm?.(timestamp);
        }
      }),
      autoCancel: true,
      alignment: DialogAlignment.Bottom,
      offset: { dx: 0, dy: -20 },
      customStyle: true
    });
  }

  /**
   * æ‰“å¼€æ—¶é—´é€‰æ‹©å™¨
   */
  private openDialog(): void {
    console.log('TimePickerComponent: æ‰“å¼€æ—¶é—´é€‰æ‹©å™¨å¯¹è¯æ¡†');
    this.dialogController?.open();
  }

  /**
   * è®¾ç½®å›è°ƒå‡½æ•°
   */
  private setCallbacks(cancel?: () => void, confirm?: (timestamp: number) => void): void {
    this.onCancel = cancel;
    this.onConfirm = confirm;
  }

  build() {
    // ç©ºå®ç°ï¼Œé€šè¿‡æ§åˆ¶å™¨æ“ä½œ
  }
}